import { Button, ListView, CheckBox } from "std-widgets.slint";

import { TaskItem } from "models.slint";
import { TaskEditorPopup } from "taskeditor.slint";

export component MainWindow inherits Window {
    width: 640px;
    height: 480px;
    title: "Command Center";

    in-out property <[TaskItem]> tasks;
    in-out property <string> status;
    in-out property <string> error;

    callback refresh();
    callback run_now(id: int);

    // Paint an explicit background to avoid white-on-white issues in some themes
    Rectangle {
        background: #f5f6f8;

        VerticalLayout {
            padding: 12px;
            spacing: 8px;

            HorizontalLayout {
                spacing: 8px;

                Button {
                    text: "Refresh";
                    clicked => { root.refresh() }
                }

                if (error != "") : Text {
                    wrap: word-wrap;
                    color: #cc0000;
                    text: error;
                }
                
                if (status != "") : Text {
                    wrap: word-wrap;
                    color: #222222;
                    text: status;
                }

                Rectangle { horizontal-stretch: 1; } // spacer
            }

            Rectangle { height: 1px; background: #dddddd; }

            Text { font-weight: 600; color: #111111; text: "Scheduled Tasks"; }

            if (tasks.length == 0 && error == "") : Text { color: #444444; text: "No tasks found."; }

            ListView {
                horizontal-stretch: 1;
                vertical-stretch: 1;
                for task in tasks : HorizontalLayout {
                    spacing: 10px;

                    Text { 
                        text: task.name; 
                        color: #111111;
                        vertical-alignment: center; 
                    }

                    CheckBox { checked: task.enabled; }

                    if (!task.enabled) : Text {
                        text: "(disabled)";
                        color: #666666;
                        vertical-alignment: center;
                    }
                    
                    if (task.enabled) : Button {
                        text: "Run Now";
                        enabled: task.enabled;
                        clicked => { root.run_now(task.id); }
                    }

                    Button {
                        text: "âœŽ Edit";
                        clicked => {
                            editor.open_for_new();
                            editor.visible = true;
                        }
                    }

                    Rectangle { horizontal-stretch: 1; } // push actions to the right
                }
            }
        }
    }

    // Editor window instance
    editor := TaskEditorPopup { }
}
